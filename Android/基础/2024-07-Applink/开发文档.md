## 前言

通过 Applink 调研文档可以看出, 采用系统支持的 Applink 有较大局限性, 同时在 Android 12 之后, 超链接标签在某些机型上也不在支持 http 与 https 作为 scheme 跳转 App. 因此我们针对应用外跳转的需求, 需要先通过 URI 打开系统浏览器, 然后通过浏览器超链接标签+自定义 Scheme 跳转到应用

![alt text](file/6router.jpg)

## Android

1. 创建 Activity 
   
```kotlin
class SchemeCallbackActivity : AppCompatActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(TextView(this))

        // 接收事件并做处理
        val uri: Uri? = intent.data
        if (uri !== null) {
            var url = uri.toString()
            startActivity(Intent(this, MainActivity::class.java).apply {
                putExtra("next_url",url)
            })
        }
    }

    override fun onResume() {
        super.onResume()
        finish()
    }
}
```

1. 配置匹配规则
   
```xml
  <activity
        android:launchMode="singleInstance"
        android:name=".activity.SchemeCallbackActivity"
        android:exported="true">
        <intent-filter>
            <category android:name="android.intent.category.DEFAULT" />
            <action android:name="android.intent.action.VIEW" />
            <category android:name="android.intent.category.BROWSABLE" />


            <!--私募短信跳转 XUEQIU-27980-->
            <data
                android:host="danjuanfunds.com"
                android:path="/rn/PrivateFund/PfMyMoney"
                android:scheme="xueqiuapp" />

            <data
                android:host="danjuanfunds.com"
                android:path="/ccount/agent/login"
                android:scheme="xueqiuapp" />
            <data
                android:host="danjuanfunds.com"
                android:path="/rn/order/detail/pf"
                android:scheme="xueqiuapp" />

                <!--正则匹配-->
            <data
                android:scheme="xueqiuapp"
                android:host="danjuanfunds.com"
                android:pathPattern="/trade-record/.*" />
            <!--私募短信跳转 XUEQIU-27980-->
        </intent-filter>

    </activity>
```

总结
1. 启动模式设置为 singleInstance 可以解决冷启动打开后无法再次接收浏览器 Intent 事件问题
2. 可以通过 path 精确匹配, 也可以通过 pathPattern 模糊匹配

## H5

```html

<!DOCTYPE html>  
<html>  
<head>  
    <title>111</title>  
</head>  
<body>  
    <h1>欢迎来到我的本地Web页面！</h1>  
    <p>这是一个简单的示例</p>  

    <a href="xueqiuapp://danjuanfunds.com/rn/PrivateFund/PfMyMoney" target="_blank">访问   xueqiuapp://danjuanfunds.com/rn/PrivateFund/PfMyMoney</a>
    <br>
    <a href="xueqiuapp://danjuanfunds.com/ccount/agent/login" target="_blank">访问   ccount/agent/login</a>
    <br>
    <a href="xueqiuapp://danjuanfunds.com/rn/order/detail/pf" target="_blank">访问   /rn/order/detail/pf</a>
    <br>


    <a href="xueqiuapp://danjuanfunds.com/trade-record/aa?a=badafd" target="_blank">访问   /trade-record/aa</a>
    <br>
    <a href="xueqiuapp://danjuanfunds.com/trade-record/bb?key=哈哈哒" target="_blank">访问   /trade-record/bb</a>
</body>  
</html>
```

总结
1. 利用系统浏览器打开 index.html, 点击标签可以触发打开 App 操作
2. 标签点击表现后交互与系统有关, 可能略有差别

<img src='file/7web.jpg' width = 400>
